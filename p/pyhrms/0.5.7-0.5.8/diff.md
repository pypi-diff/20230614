# Comparing `tmp/pyhrms-0.5.7.zip` & `tmp/pyhrms-0.5.8.zip`

## zipinfo {}

```diff
@@ -1,17 +1,17 @@
-Zip file size: 73336 bytes, number of entries: 15
-drwxrwxrwx  2.0 fat        0 b- stor 23-May-15 06:51 pyhrms-0.5.7/
-drwxrwxrwx  2.0 fat        0 b- stor 23-May-15 06:51 pyhrms-0.5.7/pyhrms/
-drwxrwxrwx  2.0 fat        0 b- stor 23-May-15 06:51 pyhrms-0.5.7/pyhrms.egg-info/
--rw-rw-rw-  2.0 fat     1088 b- defN 21-Nov-11 20:05 pyhrms-0.5.7/License.txt
--rw-rw-rw-  2.0 fat    23190 b- defN 23-May-15 06:51 pyhrms-0.5.7/PKG-INFO
--rw-rw-rw-  2.0 fat    22277 b- defN 23-May-15 06:51 pyhrms-0.5.7/README.rst
--rw-rw-rw-  2.0 fat       42 b- defN 23-May-15 06:51 pyhrms-0.5.7/setup.cfg
--rw-rw-rw-  2.0 fat      899 b- defN 23-May-15 06:48 pyhrms-0.5.7/setup.py
--rw-rw-rw-  2.0 fat   215577 b- defN 23-May-15 06:46 pyhrms-0.5.7/pyhrms/pyhrms.py
--rw-rw-rw-  2.0 fat     1311 b- defN 23-May-15 06:47 pyhrms-0.5.7/pyhrms/__init__.py
--rw-rw-rw-  2.0 fat        1 b- defN 23-May-15 06:51 pyhrms-0.5.7/pyhrms.egg-info/dependency_links.txt
--rw-rw-rw-  2.0 fat    23190 b- defN 23-May-15 06:51 pyhrms-0.5.7/pyhrms.egg-info/PKG-INFO
--rw-rw-rw-  2.0 fat      157 b- defN 23-May-15 06:51 pyhrms-0.5.7/pyhrms.egg-info/requires.txt
--rw-rw-rw-  2.0 fat      216 b- defN 23-May-15 06:51 pyhrms-0.5.7/pyhrms.egg-info/SOURCES.txt
--rw-rw-rw-  2.0 fat        7 b- defN 23-May-15 06:51 pyhrms-0.5.7/pyhrms.egg-info/top_level.txt
-15 files, 287955 bytes uncompressed, 71290 bytes compressed:  75.2%
+Zip file size: 73338 bytes, number of entries: 15
+drwxrwxrwx  2.0 fat        0 b- stor 23-Jun-14 14:38 pyhrms-0.5.8/
+drwxrwxrwx  2.0 fat        0 b- stor 23-Jun-14 14:38 pyhrms-0.5.8/pyhrms/
+drwxrwxrwx  2.0 fat        0 b- stor 23-Jun-14 14:38 pyhrms-0.5.8/pyhrms.egg-info/
+-rw-rw-rw-  2.0 fat     1088 b- defN 21-Nov-11 20:05 pyhrms-0.5.8/License.txt
+-rw-rw-rw-  2.0 fat    23057 b- defN 23-Jun-14 14:38 pyhrms-0.5.8/PKG-INFO
+-rw-rw-rw-  2.0 fat    22147 b- defN 23-Jun-14 14:38 pyhrms-0.5.8/README.rst
+-rw-rw-rw-  2.0 fat       42 b- defN 23-Jun-14 14:38 pyhrms-0.5.8/setup.cfg
+-rw-rw-rw-  2.0 fat      899 b- defN 23-Jun-14 14:37 pyhrms-0.5.8/setup.py
+-rw-rw-rw-  2.0 fat   215930 b- defN 23-Jun-14 14:20 pyhrms-0.5.8/pyhrms/pyhrms.py
+-rw-rw-rw-  2.0 fat     1311 b- defN 23-May-15 06:47 pyhrms-0.5.8/pyhrms/__init__.py
+-rw-rw-rw-  2.0 fat        1 b- defN 23-Jun-14 14:38 pyhrms-0.5.8/pyhrms.egg-info/dependency_links.txt
+-rw-rw-rw-  2.0 fat    23057 b- defN 23-Jun-14 14:38 pyhrms-0.5.8/pyhrms.egg-info/PKG-INFO
+-rw-rw-rw-  2.0 fat      157 b- defN 23-Jun-14 14:38 pyhrms-0.5.8/pyhrms.egg-info/requires.txt
+-rw-rw-rw-  2.0 fat      216 b- defN 23-Jun-14 14:38 pyhrms-0.5.8/pyhrms.egg-info/SOURCES.txt
+-rw-rw-rw-  2.0 fat        7 b- defN 23-Jun-14 14:38 pyhrms-0.5.8/pyhrms.egg-info/top_level.txt
+15 files, 287912 bytes uncompressed, 71292 bytes compressed:  75.2%
```

## zipnote {}

```diff
@@ -1,46 +1,46 @@
-Filename: pyhrms-0.5.7/
+Filename: pyhrms-0.5.8/
 Comment: 
 
-Filename: pyhrms-0.5.7/pyhrms/
+Filename: pyhrms-0.5.8/pyhrms/
 Comment: 
 
-Filename: pyhrms-0.5.7/pyhrms.egg-info/
+Filename: pyhrms-0.5.8/pyhrms.egg-info/
 Comment: 
 
-Filename: pyhrms-0.5.7/License.txt
+Filename: pyhrms-0.5.8/License.txt
 Comment: 
 
-Filename: pyhrms-0.5.7/PKG-INFO
+Filename: pyhrms-0.5.8/PKG-INFO
 Comment: 
 
-Filename: pyhrms-0.5.7/README.rst
+Filename: pyhrms-0.5.8/README.rst
 Comment: 
 
-Filename: pyhrms-0.5.7/setup.cfg
+Filename: pyhrms-0.5.8/setup.cfg
 Comment: 
 
-Filename: pyhrms-0.5.7/setup.py
+Filename: pyhrms-0.5.8/setup.py
 Comment: 
 
-Filename: pyhrms-0.5.7/pyhrms/pyhrms.py
+Filename: pyhrms-0.5.8/pyhrms/pyhrms.py
 Comment: 
 
-Filename: pyhrms-0.5.7/pyhrms/__init__.py
+Filename: pyhrms-0.5.8/pyhrms/__init__.py
 Comment: 
 
-Filename: pyhrms-0.5.7/pyhrms.egg-info/dependency_links.txt
+Filename: pyhrms-0.5.8/pyhrms.egg-info/dependency_links.txt
 Comment: 
 
-Filename: pyhrms-0.5.7/pyhrms.egg-info/PKG-INFO
+Filename: pyhrms-0.5.8/pyhrms.egg-info/PKG-INFO
 Comment: 
 
-Filename: pyhrms-0.5.7/pyhrms.egg-info/requires.txt
+Filename: pyhrms-0.5.8/pyhrms.egg-info/requires.txt
 Comment: 
 
-Filename: pyhrms-0.5.7/pyhrms.egg-info/SOURCES.txt
+Filename: pyhrms-0.5.8/pyhrms.egg-info/SOURCES.txt
 Comment: 
 
-Filename: pyhrms-0.5.7/pyhrms.egg-info/top_level.txt
+Filename: pyhrms-0.5.8/pyhrms.egg-info/top_level.txt
 Comment: 
 
 Zip file comment:
```

## Comparing `pyhrms-0.5.7/License.txt` & `pyhrms-0.5.8/License.txt`

 * *Files identical despite different names*

## Comparing `pyhrms-0.5.7/PKG-INFO` & `pyhrms-0.5.8/PKG-INFO`

 * *Files 2% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: pyhrms
-Version: 0.5.7
+Version: 0.5.8
 Summary: A powerful GC/LC-HRMS data analysis tool
 Home-page: https://github.com/WangRui5/PyHRMS.git
 Author: Wang Rui
 Author-email: wtrt7009@gmail.com
 License: UNKNOWN
 Platform: UNKNOWN
 Classifier: Programming Language :: Python :: 3
@@ -22,20 +22,17 @@
 
 Contributer: Rui Wang
 ======================
 First release date: Nov.15.2021
 
 Update
 ======
-May.15.2023: pyhrms 0.5.7 new features:
+June.14.2023: pyhrms 0.5.8 new features:
 
-    * Add DIA spectrum
-    * update DDA ms2 spectrum collection
-    * update the resolution calculation
-    * fix bugs in ms2 matching for DDA and DIA
+    * Fix some bug.
 
 
 
 
 pyhrms can be installed and import as following:
 
 .. code-block:: python
```

## Comparing `pyhrms-0.5.7/README.rst` & `pyhrms-0.5.8/README.rst`

 * *Files 0% similar despite different names*

```diff
@@ -7,20 +7,17 @@
 
 Contributer: Rui Wang
 ======================
 First release date: Nov.15.2021
 
 Update
 ======
-May.15.2023: pyhrms 0.5.7 new features:
+June.14.2023: pyhrms 0.5.8 new features:
 
-    * Add DIA spectrum
-    * update DDA ms2 spectrum collection
-    * update the resolution calculation
-    * fix bugs in ms2 matching for DDA and DIA
+    * Fix some bug.
 
 
 
 
 pyhrms can be installed and import as following:
 
 .. code-block:: python
```

## Comparing `pyhrms-0.5.7/setup.py` & `pyhrms-0.5.8/setup.py`

 * *Files 23% similar despite different names*

```diff
@@ -2,15 +2,15 @@
 
 def readme_file():
     with open('README.rst') as rf:
         return rf.read()
 
 setuptools.setup(
     name = 'pyhrms',
-    version = '0.5.7',
+    version = '0.5.8',
     author = 'Wang Rui',
     author_email = 'wtrt7009@gmail.com',
     url = 'https://github.com/WangRui5/PyHRMS.git',
     description = 'A powerful GC/LC-HRMS data analysis tool',
     long_description = readme_file(),
     packages = setuptools.find_packages(),
     install_requires = ['numpy>=1.19.2','pandas>=1.3.3'
```

## Comparing `pyhrms-0.5.7/pyhrms/pyhrms.py` & `pyhrms-0.5.8/pyhrms/pyhrms.py`

 * *Files 0% similar despite different names*

```diff
@@ -192,23 +192,27 @@
 
         # Add any remaining spectra to the last part
         if end_index < total_spectra:
             last_part = ms1[end_index:]
             parts[-1] += last_part
 
 
-
+        # just get the split time point
         parts1 = [ms1[i*part_length:(i+1)*part_length] for i in range(long_rt_split_n)]
         ranges = []
         for i, part in enumerate(parts1):
             rt_start = part[0].scan_time[0]
             rt_end = part[-1].scan_time[0]
             range1 = [rt_start,rt_end]
             ranges.append(range1)
-
+            
+        # to make sure there is no gap between each list.
+        my_list = ranges
+        ranges = [[my_list[i][0], my_list[i+1][0]] for i in range(len(my_list) - 1)] + [my_list[-1]]
+    
         # start to do peak picking for each part
         peak_list_all = []
         for n,part in enumerate(parts):
             peak_all = split_peak_picking(part, profile=profile, i_threshold=i_threshold,
                                               SN_threshold=SN_threshold, split_n=split_n, sat_intensity=sat_intensity)
             peak_all = peak_all[(peak_all['rt']>ranges[n][0])&(peak_all['rt']<=ranges[n][1])]
             peak_list_all.append(peak_all)
@@ -1067,15 +1071,15 @@
         mz_opt = [mz_opt[i] if abs(mzs[i] - mz_opt[i]) < 0.02 else mzs[i] for i in range(len(mzs))]  # 去掉偏差大的矫正结果
 
         peak_all.loc[:, ['mz', 'mz_opt', 'resolution']] = np.array([mz_obs, mz_opt, resolution.astype(int)]).T
     else:
         spec1 = [raw_info_centroid[i] for i in rt_keys]  # 获得ms的spec
         target_spec = [spec1[i][(spec1[i].index > mzs[i] - 0.015) & (spec1[i].index < mzs[i] + 0.015)] for i in
                        range(len(spec1))]
-        mzs_obs = [target_spec[i].index.values[[np.argmax(target_spec[i].values)]][0] for i in range(len(target_spec))]
+        mzs_obs = [target_spec[i].index.values[[np.argmax(target_spec[i].values)]][0] if len(target_spec[i])!=0 else mzs[i] for i in range(len(target_spec))]
         peak_all['mz'] = mzs_obs
     t4 = time.time()
     t_ = round(t4 - t3, 1)
     print(f'\r *** Checking/Optimizing mass finished: {t_} s')
 
     # 如果担心饱和质量不准，使用sat_intensity 更新质量
     if (sat_intensity is False) | (sat_intensity is None):
@@ -1459,15 +1463,15 @@
     rt_locators = [[argmin(abs(df_rt - (rt - 0.2))), argmin(abs(df_rt - (rt + 0.2)))] for rt in rts]
 
     # 4. obtain the peak areas
     area_all = [round(scipy.integrate.simps(
         df1.iloc[mz_locators[i][0]:mz_locators[i][1], rt_locators[i][0]:rt_locators[i][1]].values.sum(axis=0) - min(
             df1.iloc[mz_locators[i][0]:mz_locators[i][1], rt_locators[i][0]:rt_locators[i][1]].values.sum(axis=0)),
         df_rt[rt_locators[i][0]:rt_locators[i][1]]), 0) * 4 for i in range(len(mz_locators))]
-    # Uses the locators found in steps 2 and 3 to calculate the peak areas for each rt&mz pair in `df1`, using the `scipy.integrate.simps` function.
+    # Uses the locators found in stepas 2 and 3 to calculate the peak areas for each rt&mz pair in `df1`, using the `scipy.integrate.simps` function.
     # The result is multiplied by 4, then rounded to 0 decimal places.
 
     sample_area = pd.DataFrame(area_all, index=peak_index, columns=[name])
     return sample_area + 1  # Adds 1 to each value in the resulting data frame and returns it to avoid zero value in result.
 
 
 def peak_checking_area_split(ref_all, ms1, name1, profile=True, split_n=20, noise_threshold=0):
@@ -3382,15 +3386,15 @@
         name_s = pd.concat(name_data, axis=1).mean(axis=1)
         final_result.append(name_s)
     data = pd.concat(final_result, axis=1).astype(int)
     data.columns = names
     return data
 
 
-def omics_index_dict(path, all_new_index, names):
+def omics_index_dict(path, all_new_index, names,rt_threshold = 0.1, mz_threshold = 0.015):
     """
     Given a list of new_index values, this function checks if each value corresponds to a pair of
     retention time (rt) and mass-to-charge ratio (mz) values that are present in a set of Excel files
     containing omics data. For each sample set, the function returns a dictionary mapping sample set
     names to lists of new_index values that correspond to valid rt/mz pairs in the omics data files.
 
     Args:
@@ -3422,16 +3426,16 @@
             df = pd.read_excel(file)
             df_all.append(df)
         df_all_df = pd.concat(df_all, axis=0).reset_index(drop=True)
         index_check = []
         for i in tqdm(range(len(pair_df)), desc='Checking compounds for each new_index:'):
             rt, mz = pair_df.iloc[i, [0, 1]]
             new_index = pair_df.iloc[i].name
-            check_result = df_all_df[(df_all_df.rt > rt - 0.1) & (df_all_df.rt < rt + 0.1) &
-                                     (df_all_df.mz < mz + 0.015) & (df_all_df.mz > mz - 0.015)]
+            check_result = df_all_df[(df_all_df.rt > rt - rt_threshold) & (df_all_df.rt < rt +rt_threshold) &
+                                     (df_all_df.mz < mz +  mz_threshold) & (df_all_df.mz > mz -  mz_threshold)]
             if len(check_result) > 0:
                 index_check.append(new_index)
         final_dict[name] = index_check
     return final_dict
 
 
 def omics_filter(data, index_dict, mz_range=[100, 800], rt_range=[1, 18], area_threshold=5000):
```

## Comparing `pyhrms-0.5.7/pyhrms/__init__.py` & `pyhrms-0.5.8/pyhrms/__init__.py`

 * *Files identical despite different names*

## Comparing `pyhrms-0.5.7/pyhrms.egg-info/PKG-INFO` & `pyhrms-0.5.8/pyhrms.egg-info/PKG-INFO`

 * *Files 2% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: pyhrms
-Version: 0.5.7
+Version: 0.5.8
 Summary: A powerful GC/LC-HRMS data analysis tool
 Home-page: https://github.com/WangRui5/PyHRMS.git
 Author: Wang Rui
 Author-email: wtrt7009@gmail.com
 License: UNKNOWN
 Platform: UNKNOWN
 Classifier: Programming Language :: Python :: 3
@@ -22,20 +22,17 @@
 
 Contributer: Rui Wang
 ======================
 First release date: Nov.15.2021
 
 Update
 ======
-May.15.2023: pyhrms 0.5.7 new features:
+June.14.2023: pyhrms 0.5.8 new features:
 
-    * Add DIA spectrum
-    * update DDA ms2 spectrum collection
-    * update the resolution calculation
-    * fix bugs in ms2 matching for DDA and DIA
+    * Fix some bug.
 
 
 
 
 pyhrms can be installed and import as following:
 
 .. code-block:: python
```

